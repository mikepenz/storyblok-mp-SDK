/*
 * Copyright 2017-2019 JetBrains s.r.o. Use of this source code is governed by the Apache 2.0 license.
 * Copyright 2020 Modified by Mike Penz to be more flexible
 */

// Configures publishing of Maven artifacts to Bintray
apply plugin: 'maven'
apply plugin: 'maven-publish'
apply plugin: 'com.jfrog.bintray'

apply from: project.rootProject.file('gradle/mavenMetadata.gradle')

task stubSources(type: Jar) {
    classifier = 'sources'
}

task stubJavadoc(type: Jar) {
    classifier = 'javadoc'
}

task emptyJar(type: Jar) {
}

afterEvaluate {
    task sourcesJar(type: Jar) {
        classifier = 'sources'
        from kotlin.sourceSets.commonMain.kotlin
    }
}

afterEvaluate {
    project.publishing.publications.all {
        // rename artifacts
        if (it.name.contains('metadata')) {
            artifactId = "$POM_ARTIFACT_ID"
        } else {
            artifactId = "$POM_ARTIFACT_ID-$name"
        }
    }
}

apply from: project.rootProject.file("gradle/bintray.gradle")

bintrayUpload.doFirst {
    publications = publishing.publications.collect {
        it.name
    }.findAll {
        it != "kotlinMultiplatform"
    }
}

// This is required for K/N publishing
bintrayUpload.dependsOn publishToMavenLocal